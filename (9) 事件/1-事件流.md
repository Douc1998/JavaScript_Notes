# 事件流

当我们和浏览器进行交互时，或者浏览器在某个时刻需要执行某个任务，就是所谓的**浏览器事件**。接收和执行事件存在顺序的问题，而**事件流**玖描述了页面接收事件的顺序。在顺序角度上，主要包括两种：**事件冒泡**和**事件捕获**。

## 1. 事件冒泡
IE 事件被称为**事件冒泡**，这是因为事件被定义为从最具体的元素（文档书中最深的节点）开始触发，然后向上传播至没有那么具体的元素（文档）。比如有下面的 HTML 页面：

```html
<!DOCTYPE html>
<html>
    <head>
        <title>Event Bubbling Example</title>
    </head>
    <body>
        <div id='myDiv'>Click Me</div>
    </body>
</html>
```
在点击页面中的 `<div>` 元素后，click 事件会以如下顺序发生：
1. `<div>`
2. `<body>`
3. `<html>`
4. `document`

也就是说，`<div>` 元素，即被点击的元素，最先触发 `click` 事件，然后 click 事件沿着 DOM 树一路向上传播，在经过的每个节点上依次触发，直至到达 `document` 对象。整个流程如下图所示：

![事件冒泡](./picture/%E4%BA%8B%E4%BB%B6%E5%86%92%E6%B3%A1.png)


## 2. 事件捕获
Netscape Communicator 团队提出了另一种名为**事件捕获**的事件流。事件捕获的意思是最不具体的节点应该最先收到事件，而最具体的节点应该最后收到事件。

事件捕获实际上是为了在事件达到最终目标前拦截事件。如果前面的例子使用事件捕获，则点击 `<div>` 元素会以下列顺序触发 click 事件：

1. `document`
2. `<html>`
3. `<body>`
4. `<div>`

在事件捕获中，click 事件首先由 document 元素捕获，然后沿 DOM 树依次向下传播，直至到达实际的目标元素 div。这个过程如下图所示：

![事件捕获](./picture/%E4%BA%8B%E4%BB%B6%E6%8D%95%E8%8E%B7.png)

## 3. DOM 事件流

DOM2 Events 规范规定事件流分为 3 个阶段：**事件捕获**、**到达目标**、**事件冒泡**。

事件捕获最先发生，为提前拦截事件提供了可能。然后，实际的目标元素接收到事件。最后一个阶段是冒泡，最迟要在这个阶段响应时间。仍以前面那个简单的 HTML 为例，点击 `<div>` 元素，会以下图所示的顺序触发事件。

![DOM事件流](./picture/DOM%E4%BA%8B%E4%BB%B6%E6%B5%81.png)

在 DOM 事件流中，实际的目标（div 元素）在捕获阶段不会接收到事件。这是因为捕获阶段从 document 到 html 再到 body 就结束了。下一阶段，即会在 div 元素上触发事件的 “到达目标” 阶段，通常在事件处理时被认为是冒泡阶段的一部分。然后，冒泡阶段开始，事件方向传播至 document。

大多数支持 DOM 事件流的浏览器实现了一个小小的拓展。虽然 DOM2 Events 规范明确捕获阶段不命中事件目标，但现代浏览器都会在捕获阶段在事件目标上触发事件。最终结果是在事件目标上有两个机会来处理事件。